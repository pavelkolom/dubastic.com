"use strict";$(function(){if(window.location.hash){for(var t=window.location.hash;"#"==t.charAt(0);)t=t.substr(1);var o,e,a,s,r=$("div[data-postID='"+t+"']");0<$("#PostStream").has(r).length&&((o=r.offset())&&(e=$("#ForumContainer #TopBreadcrumb").outerHeight(),a=parseInt($(".postItem").css("margin-top"),10),s=o.top-e-a,$("html,body").animate({scrollTop:s},"fast")))}});var PopForums={areaPath:"/Forums",currentTopicState:null,editorCSS:"/lib/bootstrap/dist/css/bootstrap.min.css,/lib/PopForums/dist/Editor.min.css",postNoImageToolbar:"cut copy paste | bold italic | bullist numlist blockquote removeformat | link"};PopForums.editorSettings={theme:"silver",plugins:"paste lists image link",content_css:PopForums.editorCSS,menubar:!1,toolbar:"cut copy paste | bold italic | bullist numlist blockquote removeformat | link | image",statusbar:!1,target_list:!1,link_title:!1,image_description:!1,image_dimensions:!1,browser_spellcheck:!0,object_resizing:!1,relative_urls:!1,remove_script_host:!1,contextmenu:"",mobile:{theme:"silver"},paste_as_text:!0},PopForums.processLogin=function(){PopForums.processLoginBase("/Identity/Login")},PopForums.processLoginExternal=function(){PopForums.processLoginBase("/Identity/LoginAndAssociate")},PopForums.processLoginBase=function(t){$.ajax({url:PopForums.areaPath+t,type:"POST",data:{email:$("#EmailLogin").val(),password:$("#PasswordLogin").val(),persistCookie:$("#PersistCookie").is(":checked")},dataType:"json",success:function(t){var o=$("#LoginResult");switch(t.result){case!0:var e=$("#Referrer").val();location=e;break;default:o.html(t.message),o.removeClass("d-none")}},error:function(){var t=$("#LoginResult");t.html("There was an unknown error while attempting login"),t.removeClass("d-none")}})},PopForums.topicListSetup=function(o){PopForums.startTimeUpdater();var e=$("#NewTopicButton");e.click(function(){var t=$("#NewTopic");t.load(PopForums.areaPath+"/Forum/PostTopic/"+o,function(){"true"==$("#IsImageEnabled").val().toLowerCase()||(PopForums.editorSettings.toolbar=PopForums.postNoImageToolbar),"true"==$("#IsPlainText").val().toLowerCase()||(PopForums.editorSettings.selector="#NewTopic #FullText",tinyMCE.init(PopForums.editorSettings)),t.slideDown(),e.hide(),$("#PreviewModal").on("shown.bs.modal",function(){PopForums.previewPost()})})})},PopForums.loadReply=function(o,t,e,a){$(window).off("scroll",PopForums.ScrollLoad);var s=$("#NewReply"),r=PopForums.areaPath+"/Forum/PostReply/"+o;null!=t&&(r+="?quotePostID="+t),null!=e&&(r+=null==t?"?replyID="+e:"&replyID="+e),s.load(r,function(){var t;"true"==$("#IsImageEnabled").val().toLowerCase()||(PopForums.editorSettings.toolbar=PopForums.postNoImageToolbar),"true"==$("#IsPlainText").val().toLowerCase()||(PopForums.editorSettings.selector="#NewReply #FullText",tinyMCE.init(PopForums.editorSettings)),s.slideDown(),$("#ReplyButton").hide(),PopForums.scrollToElement("NewReply"),$("#MorePostsBeforeReplyButton").click(function(){$.get(PopForums.areaPath+"/Forum/TopicPartial/"+o+"?lastPost="+PopForums.currentTopicState.lastVisiblePost+"&lowpage="+PopForums.currentTopicState.lowPage,function(t){var o=$(t),e=o.find(".pagerLinks").detach(),a=o.find(".lastPostID").detach();PopForums.currentTopicState.lastVisiblePost=a.val(),$("#PostStream").append(o),e.replaceAll(".pagerLinks"),$(".postItem img:not('.avatar')").addClass("postImage"),$(".morePostsButton").remove(),PopForums.setReplyMorePosts(PopForums.currentTopicState.lastVisiblePost)})}),a&&(t=(new signalR.HubConnectionBuilder).withUrl("/TopicsHub").build()).start().then(function(){t.invoke("getLastPostID",o).then(function(t){PopForums.setReplyMorePosts(t)})}),$("#PreviewModal").on("shown.bs.modal",function(){PopForums.previewPost()}),PopForums.TopicState.replyLoaded=!0})},PopForums.loadComment=function(t,o){var e=$("[data-postid*='"+o+"']").find(".commentHolder"),a=PopForums.areaPath+"/Forum/PostReply/"+t;null!=o&&(a+="?replyID="+o),e.load(a,function(){"true"==$("#IsImageEnabled").val().toLowerCase()||(PopForums.editorSettings.toolbar=PopForums.postNoImageToolbar),"true"==$("#IsPlainText").val().toLowerCase()||(PopForums.editorSettings.selector=".postForm #FullText",tinyMCE.init(PopForums.editorSettings)),e.slideDown(),$("#PreviewModal").on("shown.bs.modal",function(){PopForums.previewPost()})})},PopForums.previewPost=function(){tinyMCE.triggerSave();var o=$("#ParsedFullText");$.ajax({url:PopForums.areaPath+"/Forum/PreviewText",type:"POST",data:{FullText:$(".postForm #FullText").val(),IsPlainText:$(".postForm #IsPlainText").val()},dataType:"json",converters:{"text json":!0},success:function(t){o.html(t)},error:function(){o.html("There was a problem getting the preview.")}})},PopForums.loadFeed=function(){var t=(new signalR.HubConnectionBuilder).withUrl("/FeedHub").build();t.on("notifyFeed",function(t){var o=$("#FeedList"),e=PopForums.populateFeedRow(t);o.prepend(e),e.fadeIn()}),t.start().then(function(){return t.invoke("listenToAll")}),PopForums.startTimeUpdater()},PopForums.populateFeedRow=function(t){var o=$("#ActivityFeedTemplate").clone();return o.removeAttr("id"),o.find(".feedItemText").html(t.message),o.find(".fTime").attr("data-utc",t.utc),o.find(".fTime").text(t.timeStamp),o},PopForums.setReplyMorePosts=function(t){t==PopForums.currentTopicState.lastVisiblePost?$("#MorePostsBeforeReplyButton").css("visibility","hidden"):$("#MorePostsBeforeReplyButton").css("visibility","visible")},PopForums.topicSetup=function(e,t,o,a){PopForums.startTimeUpdater();var s=$("#LastPostID").val();PopForums.currentTopicState=new PopForums.TopicState(t,s,o,e);var r=(new signalR.HubConnectionBuilder).withUrl("/TopicsHub").build();r.on("fetchNewPost",function(t){PopForums.TopicState.replyLoaded||PopForums.currentTopicState.highPage!=PopForums.currentTopicState.pageCount||($.get(PopForums.areaPath+"/Forum/Post/"+t,function(t){$(t).appendTo("#PostStream")}),$("#LastPostID").val(t),PopForums.currentTopicState.lastVisiblePost=t)}),r.on("notifyNewPosts",function(t){PopForums.setReplyMorePosts(t)}),r.start().then(function(){return r.invoke("listenTo",e)}),$(".postItem img:not('.avatar')").addClass("postImage"),$(document).on("click","#ReplyButton,.replyLink",function(){PopForums.loadReply(e,null,a,!0)}),$(document).on("click",".quoteLink",function(){var t=$(this).parents(".postItem").attr("data-postID");PopForums.loadReply(e,t,a,!0)}),$(document).on("click",".postNameLink",function(){var t=$(this).parents(".postItem").find(".miniProfileBox"),o=$(this).parents(".postItem").attr("data-userID"),e=$(this).find(".twirl");PopForums.loadMiniProfile(o,t,e)}),$(document).on("click",".voteCount",function(){var t=$(this).parents(".postItem"),o=t.attr("data-postID");t.find(".voters").slideDown(function(){$(this).load(PopForums.areaPath+"/Forum/Voters/"+o),$(this).mouseleave(function(){$(this).hide()}),$(this).css("display","block")}).css("display","block")}),$(document).on("click",".voteUp",function(){var o=$(this).parents(".postItem"),t=o.attr("data-postID"),e=$(this).closest(".postToolContainer").children(".voteCount");$.ajax({url:PopForums.areaPath+"/Forum/VotePost/"+t,type:"POST",success:function(t){e.html(t),o.find(".voteUp").replaceWith('<li class="list-inline-item">Voted</li>')}})}),PopForums.SetupSubscribeButton(e),PopForums.SetupFavoriteButton(e),$("#TopicModLogButton").click(function(){var t=$("#TopicModerationLog");t.is(":hidden")?t.load(PopForums.areaPath+"/Moderator/TopicModerationLog/"+e,function(){t.slideDown()}):t.slideUp()}),$(document).on("click",".postModLogButton",function(){var t=$(this).attr("data-postID"),o=$(this).closest(".postToolContainer").find(".moderationLog");o.is(":hidden")?o.load(PopForums.areaPath+"/Moderator/PostModerationLog/"+t,function(){o.slideDown()}):o.slideUp()}),$(document).on("click",".morePostsButton",function(){PopForums.LoadMorePosts(e,this)}),$(document).on("click",".previousPostsButton",function(){PopForums.currentTopicState.addStartPage();var t=PopForums.currentTopicState.lowPage,o=e,a=$("#PostStream"),s=$(this).detach();$.get(PopForums.areaPath+"/Forum/TopicPage/"+o+"?pageNumber="+t+"&low="+PopForums.currentTopicState.lowPage+"&high="+PopForums.currentTopicState.highPage,function(t){var o=$(t),e=o.find(".pagerLinks").detach();a.prepend(o),e.replaceAll(".pagerLinks"),1<PopForums.currentTopicState.lowPage&&a.prepend(s),$(".postItem img:not('.avatar')").addClass("postImage"),PopForums.currentTopicState.highPage==PopForums.currentTopicState.pageCount&&1==PopForums.currentTopicState.lowPage&&$(".pagerLinks").remove()})}),$(window).on("scroll",PopForums.ScrollLoad)},PopForums.qaTopicSetup=function(o){PopForums.startTimeUpdater(),$(".postItem img:not('.avatar')").addClass("postImage"),$(document).on("click",".commentLink",function(){var t=$(this).parents(".postItem").attr("data-postid");PopForums.loadComment(o,t)}),$(document).on("click","#ReplyButton",function(){var t=$(this).parents(".postContainer").attr("data-postid");PopForums.loadReply(o,null,t)}),$(document).on("click",".postNameLink",function(){var t=$(this).parents(".postUserData").find(".miniProfileBox"),o=$(this).parents(".postUserData").attr("data-userID"),e=$(this).find(".twirl");PopForums.loadMiniProfile(o,t,e)}),$(document).on("click",".voteUp",function(){var e=$(this).parents(".postItem"),t=e.attr("data-postid"),a=$(this).parents(".answerData").find(".badge");$.ajax({url:PopForums.areaPath+"/Forum/VotePost/"+t,type:"POST",success:function(t){a.html(t);var o=e.find(".voteUp");o.html("Voted"),o.removeClass("btn-link")}})}),$(document).on("click",".answerButton",function(){var t=$(this),o=t.parents(".postItem"),e=o.attr("data-postid"),a=o.attr("data-topicid");$.ajax({url:PopForums.areaPath+"/Forum/SetAnswer/",type:"POST",data:{postID:e,topicID:a},success:function(){$(".answerStatus").removeClass("icon-checkmark text-success").addClass("icon-checkmark2 text-muted"),t.removeClass("icon-checkmark2 text-muted").addClass("icon-checkmark text-success")}})}),PopForums.SetupSubscribeButton(o),PopForums.SetupFavoriteButton(o),$("#TopicModLogButton").click(function(){var t=$("#TopicModerationLog");t.is(":none")?t.load(PopForums.areaPath+"/Moderator/TopicModerationLog/"+o,function(){t.slideDown()}):t.slideUp()}),$(document).on("click",".postModLogButton",function(){var t=$(this).attr("data-postID"),o=$(this).closest(".postToolContainer").find(".moderationLog");o.is(":hidden")?o.load(PopForums.areaPath+"/Moderator/PostModerationLog/"+t,function(){o.slideDown()}):o.slideUp()})},PopForums.SetupSubscribeButton=function(t){var e=$("#SubscribeButton");e.click(function(){var o=$("#AsyncResponse");$.ajax({url:PopForums.areaPath+"/Subscription/ToggleSubscription/"+t,type:"POST",dataType:"json",success:function(t){switch(t.data.isSubscribed){case!0:e.val("Unsubscribe");break;case!1:e.val("Subscribe");break;default:o.html(t.Message)}},error:function(){o.html("There was an unknown error while attempting to use subscription")}})})},PopForums.SetupFavoriteButton=function(t){var e=$("#FavoriteButton");e.click(function(){var o=$("#AsyncResponse");$.ajax({url:PopForums.areaPath+"/Favorites/ToggleFavorite/"+t,type:"POST",dataType:"json",success:function(t){switch(t.data.isFavorite){case!0:e.val("Remove From Favorites");break;case!1:e.val("Make Favorite");break;default:o.html(t.Message)}},error:function(){o.html("There was an unknown error while attempting to use favorites")}})})},PopForums.ScrollLoad=function(){var t,o=$(window),e=$("#StreamBottom").offset().top-(o.scrollTop()+o.height());!PopForums.currentTopicState.loadingPosts&&e<250&&PopForums.currentTopicState.highPage<PopForums.currentTopicState.pageCount&&(PopForums.currentTopicState.loadingPosts=!0,t=$(".morePostsButton"),PopForums.LoadMorePosts(PopForums.currentTopicState.topicID,t))},PopForums.LoadMorePosts=function(t,o){PopForums.currentTopicState.addEndPage();var e=PopForums.currentTopicState.highPage,a=t,r=$("#PostStream"),i=$(o).detach();$.get(PopForums.areaPath+"/Forum/TopicPage/"+a+"?pageNumber="+e+"&low="+PopForums.currentTopicState.lowPage+"&high="+PopForums.currentTopicState.highPage,function(t){var o=$(t),e=o.find(".pagerLinks").detach(),a=o.find(".lastPostID").detach(),s=o.find(".pageCount").detach();PopForums.currentTopicState.lastVisiblePost=a.val(),PopForums.currentTopicState.pageCount=s.val(),o=$("<div>").append(o),r.append(o),e.replaceAll(".pagerLinks"),PopForums.currentTopicState.highPage!=PopForums.currentTopicState.pageCount&&r.append(i),PopForums.currentTopicState.highPage==PopForums.currentTopicState.pageCount&&1==PopForums.currentTopicState.lowPage&&$(".pagerLinks").remove(),$(".postItem img:not('.avatar')").addClass("postImage"),PopForums.currentTopicState.loadingPosts=!1})},PopForums.TopicState=function(t,o,e,a){this.lowPage=t,this.highPage=t,this.lastVisiblePost=o,this.pageCount=e,this.loadingPosts=!1,this.topicID=a,this.replyLoaded=!1},PopForums.TopicState.prototype.addEndPage=function(){this.highPage++},PopForums.TopicState.prototype.addStartPage=function(){this.lowPage--},PopForums.postNewTopic=function(){$("SubmitNewTopic").attr("disabled","disabled"),tinyMCE.triggerSave(),$.ajax({url:PopForums.areaPath+"/Forum/PostTopic",type:"POST",data:{Title:$("#NewTopic #Title").val(),FullText:$("#NewTopic #FullText").val(),IncludeSignature:$("#NewTopic #IncludeSignature").is(":checked"),ItemID:$("#NewTopic #ItemID").val(),IsPlainText:$("#NewTopic #IsPlainText").val()},dataType:"json",success:function(t){var o=$("#PostResponseMessage");switch(t.result){case!0:window.location=t.redirect;break;default:o.html(t.message),$("#SubmitNewTopic").removeAttr("disabled"),o.show()}},error:function(){var t=$("#PostResponseMessage");t.html("There was an unknown error while trying to post"),$("#SubmitNewTopic").removeAttr("disabled"),t.show()}})},PopForums.postReply=function(){$("#SubmitReply").attr("disabled","disabled"),tinyMCE.triggerSave(),$.ajax({url:PopForums.areaPath+"/Forum/PostReply",type:"POST",data:{Title:$("#NewReply #Title").val(),FullText:$("#NewReply #FullText").val(),IncludeSignature:$("#NewReply #IncludeSignature").is(":checked"),ItemID:$("#NewReply #ItemID").val(),CloseOnReply:$("#CloseOnReply").is(":checked"),IsPlainText:$("#NewReply #IsPlainText").val(),ParentPostID:$("#NewReply #ParentPostID").val()},dataType:"json",success:function(t){var o=$("#PostResponseMessage");switch(t.result){case!0:window.location=t.redirect;break;default:o.html(t.message),$("#SubmitReply").removeAttr("disabled"),o.show()}},error:function(){var t=$("#PostResponseMessage");t.html("There was an unknown error while trying to post"),$("#SubmitReply").removeAttr("disabled"),t.show()}})},PopForums.loadMiniProfile=function(t,o,e){o.is(":hidden")?o.load(PopForums.areaPath+"/Account/MiniProfile/"+t,function(){o.slideDown()}):o.slideUp(),e.toggleClass("glyphicon-chevron-right glyphicon-chevron-down")},PopForums.scrollToElement=function(t){var o=document.getElementById(t),e=0;if(o.offsetParent)for(;o.offsetParent;)e+=o.offsetTop,o=o.offsetParent;else o.y&&(e+=o.y);var a=$("#TopBreadcrumb");a&&(e-=a.outerHeight()),scrollTo(0,e)},PopForums.homeSetup=function(){var t=(new signalR.HubConnectionBuilder).withUrl("/ForumsHub").build();t.on("notifyForumUpdate",function(t){PopForums.updateForumStats(t)}),t.start().then(function(){return t.invoke("listenToAll")}),PopForums.startTimeUpdater()},PopForums.recentListen=function(s){var t=(new signalR.HubConnectionBuilder).withUrl("/RecentHub").build();t.on("notifyRecentUpdate",function(t){var o,e=$('#TopicList tr[data-topicID="'+t.topicID+'"]');0!=e.length?(e.fadeOut(),e.remove()):(o=$("#TopicList tr:not('#TopicTemplate')")).length==s&&o.last().remove();var a=PopForums.populateTopicRow(t).hide();a.removeClass("hidden"),$("#TopicList").prepend(a),a.fadeIn()}),t.start().then(function(){return t.invoke("register")})},PopForums.forumListen=function(s,t){var o=(new signalR.HubConnectionBuilder).withUrl("/ForumsHub").build();o.on("notifyUpdatedTopic",function(t){var o,e=$('#TopicList tr[data-topicID="'+t.topicID+'"]');0!=e.length?(e.fadeOut(),e.remove()):(o=$("#TopicList tr:not('#TopicTemplate')")).length==s&&o.last().remove();var a=PopForums.populateTopicRow(t).hide();a.removeClass("hidden"),$("#TopicList").prepend(a),a.fadeIn()}),o.start().then(function(){return o.invoke("listenTo",t)})},PopForums.populateTopicRow=function(t){var o=$("#TopicTemplate").clone();return o.attr("data-topicid",t.topicID),o.removeAttr("id"),o.find(".startedByName").text(t.startedByName),o.find(".indicatorLink").attr("href",t.link),o.find(".titleLink").text(t.title),o.find(".titleLink").attr("href",t.link),o.find(".forumTitle").text(t.forumTitle),o.find(".viewCount").text(t.viewCount),o.find(".replyCount").text(t.replyCount),o.find(".lastPostTime").text(t.lastPostTime),o.find(".lastPostName").text(t.lastPostName),o.find(".fTime").attr("data-utc",t.utc),o},PopForums.updateForumStats=function(t){var o=$("[data-forumid='"+t.forumID+"']");o.find(".topicCount").text(t.topicCount),o.find(".postCount").text(t.postCount),o.find(".lastPostTime").text(t.lastPostTime),o.find(".lastPostName").text(t.lastPostName),o.find(".fTime").attr("data-utc",t.utc),o.find(".newIndicator .icon-file-text2").removeClass("text-muted").addClass("text-warning")},PopForums.startTimeUpdater=function(){setTimeout(function(){PopForums.startTimeUpdater(),PopForums.updateTimes()},6e4)},PopForums.updateTimes=function(){var o=[],t=$(".fTime");$.each(t,function(){var t=$(this).attr("data-utc");(new Date-new Date(t+"Z"))/36e5<48&&o.push(t)}),0<o.length&&$.ajax({url:PopForums.areaPath+"/Time/GetTimes",type:"POST",data:{times:o},dataType:"json",traditional:!0,success:function(t){$.each(t,function(){$(".fTime[data-utc='"+this.key+"']").text(this.value)})},error:function(){}})};
//# sourceMappingURL=PopForums.min.js.map
